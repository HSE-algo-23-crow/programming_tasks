# Муравьиный алгоритм для решения задачи коммивояжера

## Описание алгоритма
Муравьиный алгоритм - алгоритм решения комбинаторных задач, в том числе задачи коммивояжёра. 

Алгоритм вдохновлен поведением муравьев, перед которыми встаёт задача поиска оптимального пути. Хоть сами муравьи не очень умные, построенный ими маршрут зачастую близок к оптимальному.

В основе муравьиного алгоритма лежит понятие феромона. Как в реальной жизни муравьи оставляют феромон на пройденном ими пути, так и в нашей задачи мы будим "насыпать феромон" для добаления привлекательности тому или иному пути.

Количество насыпаемого феромона зависит от того, сколько муравьев прошло по заданному маршруту, а также от общей длины маршрута конкретного муравья. Так например, муровей прошедший маршрут в 4000 у.е. оставит в два раза меньше феромона на своем пути (количество феромона на единицу расстояния), чем муровей прошедший маршрут в 2000 у.е..

Путь каждого муравья выбирается исходя из его желания пройти по какому-то пути из оставшихся. Вероятность пройти по пути равна желанию пройти по этому пути поделенному на сумму желаний пройти по всем доступным путям.

Желание пройти по пути расчитывается исходя из длины пути (чем больши длина тем меньше желание) и количества феромона на пути (чем больше феромона, тем больше желание).

### Итерация алгоритма:

- Из каждой вершины графа выходит муровей
- В начале пути просчитывается вероятность пройти по каждому из доступных путей (в начале работы алгоритма количество феромона на каждом маршруте одинакова)
- Запускается рандомизатор, который выбирает путь для муравья, учитывая эти вероятности
- После перехода в новую точку вероятности пересчитываются (с учётом того что начальная точка не доступна)
- Рандомизатор снова выбирает куда пойдет муравей
- Так повторяется до тех пор пока муравей не придет в последнюю из доступных точек
- После того как все муравьи прошли свой маршрут, на дороги между точками насыпается феромон исходя из того, сколько муравьев прошло по этой дороге и какова была общая длина их пути
- Часть феромона испаряется с карты
- Запускается новая итерация с учетом новой "карты феромонов"

### Входные данные:
- Матрица расстояний между вершинами графа. В нашем случае пути есть всеми вершинами
- Матрица количества феромона на пути между двумя точками
- Константы, отвечающие за то какой вес придается значению феромона и длины пути при определении желания пройти по этому пути.
- Константа испарения феромона между итерациями
- Константа, на которую делится общая длина маршрута муравья, чтобы определить сколько феромона муравей оставил после себя

### Выходные данные: минимальный из найденных за все итерации маршрут

### Точкой останова:
Точкой останова могут служить разные критерии. Например, достижение i-ой итерации или факт того, что минимальный маршрут не менялся на протяжении N итераций.

### Области допустимых значений:
Любой граф (при неодходимости занулить маршрут, его длину можно прировнять к бесконечности)

## Пример выполнения алгоритма
У нас есть граф с расстояниями между четырьмя вершинами.
~~~ mermaid
graph TB
    1(#1)<-->|10|2(#2)
    1<-->|10|3(#3)
    2<-->|10|4(#4)
    3<-->|10|4(#4)
    2<-->|10|3(#3)
    1<-->|17|4(#4)
~~~
Первый муравей выходит из вершины один.

Его желание пойти к разным вершинам:

- 1-2 p = (0.1)/(0.1 + 0.1 + 1/17) = 0.39
- 1-3 p = (0.1)/(0.1 + 0.1 + 1/17) = 0.39
- 1-4 p = (1/17)/(0.1+0.1+1.17) = 0.22

На первой итерации мы не учитываем значение феромона, так как оно одинаково на всех путях.
 
Видно, что вероятность пойти по дороге 1-2 или 1-3 выше, чем 1-4.

Запускаем рандомайзер, который выбирает путь с учётом весов: 67. Сумма наших вероятностей равна 1. Точке 0.67 соответствует маршрут 1-3.

Теперь мы находимся в точке 3. 

Шанс пойти из точки 3:

- 3-2 p = 0.1/(0.1 + 1/17)
- 3-4 p = 0.1/(0.1 + 1/17)

Шансы одинаковые. Допустим рандомайзер выбрал маршрут 3-2.

Находясь в точке два у нас нет выбора кроме как пойти в точку 4, из которой мы отправляемся в точку 1.

Наш маршрут 1-3-2-4-1 имеет длину 10+10+10+17=47. 

Допустим из точки два вышел муравей и его маршрут был: 2-4-3-1-2. Его длина - 40.

Допустим, что больше маравьев на этой итерации не будет. Тогда мы должны, во-первых, испарить часть феромона на путях (на первой итерации испарять нечего), во-вторых, добавить феромон от наших муравьев. Муравей два прошел более коротким путём, следовательно оставит больше феромона, чем муравей один, что сделает дороги, по которым прошел муравей два более привлекательными. Количество феромона, оставленного муравьями, рассчитывается как константа Q поделенная на пройденный путь. Возьмём Q=4. Тогда второй муравей оставит на каждой из пройденных дорог - 4/40=0.1 феромона, а пкрвый 4/47=0.085 феромона.

При добалении феромона учитываем всех муравьев. Например, по пути 2-4 прошли оба муравья, следовательно уоличество феромона на пути увелисится на 0.085+0.1=0.185. По дороге 3-2 прошёл только первый муравей, прибавка феромона - 0.085.

Стартанем вторую итерацию. Пусть она будет последней. В этой итерации мы выпустим одного муравья из точки 1.

Шанс пойти по путям:

- 1-2 p = (0.1 * 0.1)/(0.1 * 0.1 + 0.1 * 0.185 + 1/17*0.085) = 0.30
- 1-3 p = (0.1 * 0.185)/(0.1 * 0.1 + 0.1 * 0.185 + 1/17*0.085) = 0.55
- 1-4 p = (1/17*0.085)/(0.1 * 0.1 + 0.1 * 0.185 + 1/17*0.085) = 0.15

Рандомайзер выбраk 42, следовательно идём по пути 1-3.

Из точки 3 шанс пойти по путям:

- 3-2 p = (0.1 * 0.085)/(0.1 * 0.085 + 0.1 * 0.1) = 0.46
- 3-4 p = (0.1 * 0.1)/(0.1 * 0.085 + 0.1 * 0.1) = 0.54

Рандомайзер выбрал 60, идём по пути 3-4.

Из точки четыре мы можем пойти только по пути 4-2, а от туда сразу в 1. Таким образом наш маршрут 1-3-4-2-1, его длина 40.

Алгоритм закончил свою работу длина найденного им маршрута 40 действительно является наименьшей. Но мы не всегда придём к такому результату. Алгоритм не гарантирует точный ответ, но обещает, что с ростом числа итераций качество ответа не ухудшается.